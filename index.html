<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Free Note</title>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <style>
        body { background-color: #000; margin: 0; overflow: hidden; font-family: sans-serif; touch-action: none; }
        #wall { width: 100vw; height: 75vh; position: relative; }
        .sticky-note {
            width: 150px; min-height: 100px; padding: 15px;
            position: absolute; background-color: #fff; color: #000;
            box-shadow: 0 4px 15px rgba(255,255,255,0.2);
            word-wrap: break-word; font-size: 14px; border-radius: 2px;
            cursor: move; user-select: none; z-index: 10;
        }
        #dock {
            width: 100vw; height: 25vh; background-color: #111;
            border-top: 1px solid #333; display: flex;
            justify-content: center; align-items: center; gap: 20px;
            position: fixed; bottom: 0; z-index: 1000;
        }
        #note-input { width: 300px; height: 80px; padding: 10px; font-size: 16px; border: none; outline: none; border-radius: 5px; }
        #add-btn { background-color: #fff; color: #000; border: none; padding: 20px 30px; font-weight: bold; cursor: pointer; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="wall"></div>
    <div id="dock">
        <textarea id="note-input" maxlength="500" placeholder="Hãy Thử Viết Gì Đó ... (Giới hạn 500 kí tự)"></textarea>
        <button id="add-btn" onclick="sendToCloud()">DÁN LÊN</button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyARz3WftjUZ_fRoHn4EcL6k9BGlLNiyMA",
            authDomain: "note-15380.firebaseapp.com",
            databaseURL: "https://note-15380-default-rtdb.firebaseio.com/", 
            projectId: "note-15380",
            storageBucket: "note-15380.firebasestorage.app",
            messagingSenderId: "834783700925",
            appId: "1:834783700925:web:63768ddccd55b6c55a94d4"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        db.ref('notes').on('value', (snapshot) => {
            const wall = document.getElementById('wall');
            wall.innerHTML = ""; 
            const data = snapshot.val();
            if(!data) return;
            for (let id in data) {
                const note = document.createElement('div');
                note.className = 'sticky-note';
                note.innerText = data[id].text;
                note.style.left = data[id].x;
                note.style.top = data[id].y;
                // Chạm 2 lần trên đt hoặc click đúp trên mt để xóa
                note.ondblclick = () => { if(confirm("Xóa note?")) db.ref('notes/'+id).remove(); };
                makeDraggable(note, id);
                wall.appendChild(note);
            }
        });

        function makeDraggable(el, id) {
            function startDragging(e) {
                el.style.zIndex = 1000;
                let clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                let clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;

                let shiftX = clientX - el.getBoundingClientRect().left;
                let shiftY = clientY - el.getBoundingClientRect().top;

                function onMove(event) {
                    let pageX = event.type.includes('touch') ? event.touches[0].pageX : event.pageX;
                    let pageY = event.type.includes('touch') ? event.touches[0].pageY : event.pageY;
                    el.style.left = pageX - shiftX + 'px';
                    el.style.top = pageY - shiftY + 'px';
                }

                document.addEventListener('mousemove', onMove);
                document.addEventListener('touchmove', onMove, {passive: false});

                function onEnd() {
                    document.removeEventListener('mousemove', onMove);
                    document.removeEventListener('touchmove', onMove);
                    el.onmouseup = null;
                    el.ontouchend = null;
                    db.ref('notes/' + id).update({ x: el.style.left, y: el.style.top });
                }

                el.onmouseup = onEnd;
                el.ontouchend = onEnd;
            }

            el.onmousedown = startDragging;
            el.ontouchstart = startDragging;
            el.ondragstart = () => false;
        }

        function sendToCloud() {
            const input = document.getElementById('note-input');
            const text = input.value.trim();
            if (text === "") return;
            const x = (Math.random() * (window.innerWidth - 170)) + 'px';
            const y = (Math.random() * (window.innerHeight * 0.4)) + 'px';
            db.ref('notes').push({ text, x, y });
            input.value = "";
        }
    </script>
</body>
</html>
